{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"setup","msg":"Starting CloudNativePG Instance Manager","logging_pod":"cluster-example-3","version":"1.19.1","build":{"Version":"1.19.1","Commit":"cb24d237","Date":"2023-03-20"}}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"setup","msg":"starting controller-runtime manager","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Starting EventSource","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","source":"kind source: *v1.Cluster"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Starting Controller","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster"}
{"level":"debug","ts":"2023-03-24T05:18:45Z","msg":"starting the postgres loop","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:18:45Z","msg":"starting signal loop","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:18:45Z","msg":"Checking PGDATA coherence","caller":"internal/cmd/manager/instance/run/lifecycle/run.go:255","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Starting webserver","logging_pod":"cluster-example-3","address":":9187"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Starting webserver","logging_pod":"cluster-example-3","address":":8000"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Starting webserver","logging_pod":"cluster-example-3","address":"localhost:8010"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Starting workers","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","worker count":1}
{"level":"debug","ts":"2023-03-24T05:18:45Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"1c2d3ce1-9664-4ae9-be90-2ea8968f86ff","uuid":"598ce94b-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:18:45Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"1c2d3ce1-9664-4ae9-be90-2ea8968f86ff","uuid":"598ce94b-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Refreshed configuration file","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"1c2d3ce1-9664-4ae9-be90-2ea8968f86ff","uuid":"598ce94b-ca03-11ed-9d47-ce5618e63535","logging_pod":"cluster-example-3","filename":"/controller/certificates/server.crt","secret":"cluster-example-server"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Refreshed configuration file","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"1c2d3ce1-9664-4ae9-be90-2ea8968f86ff","uuid":"598ce94b-ca03-11ed-9d47-ce5618e63535","logging_pod":"cluster-example-3","filename":"/controller/certificates/server.key","secret":"cluster-example-server"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Refreshed configuration file","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"1c2d3ce1-9664-4ae9-be90-2ea8968f86ff","uuid":"598ce94b-ca03-11ed-9d47-ce5618e63535","logging_pod":"cluster-example-3","filename":"/controller/certificates/streaming_replica.crt","secret":"cluster-example-replication"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Refreshed configuration file","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"1c2d3ce1-9664-4ae9-be90-2ea8968f86ff","uuid":"598ce94b-ca03-11ed-9d47-ce5618e63535","logging_pod":"cluster-example-3","filename":"/controller/certificates/streaming_replica.key","secret":"cluster-example-replication"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Refreshed configuration file","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"1c2d3ce1-9664-4ae9-be90-2ea8968f86ff","uuid":"598ce94b-ca03-11ed-9d47-ce5618e63535","logging_pod":"cluster-example-3","filename":"/controller/certificates/client-ca.crt","secret":"cluster-example-ca"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Refreshed configuration file","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"1c2d3ce1-9664-4ae9-be90-2ea8968f86ff","uuid":"598ce94b-ca03-11ed-9d47-ce5618e63535","logging_pod":"cluster-example-3","filename":"/controller/certificates/server-ca.crt","secret":"cluster-example-ca"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Updated replication settings in postgresql.auto.conf file","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Extracting pg_controldata information","logging_pod":"cluster-example-3","reason":"postmaster start up"}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"pg_controldata","msg":"pg_control version number:            1300\nCatalog version number:               202209061\nDatabase system identifier:           7213723966086483989\nDatabase cluster state:               in production\npg_control last modified:             Fri 24 Mar 2023 05:18:29 AM UTC\nLatest checkpoint location:           0/D000060\nLatest checkpoint's REDO location:    0/D000028\nLatest checkpoint's REDO WAL file:    00000004000000000000000D\nLatest checkpoint's TimeLineID:       4\nLatest checkpoint's PrevTimeLineID:   4\nLatest checkpoint's full_page_writes: on\nLatest checkpoint's NextXID:          0:744\nLatest checkpoint's NextOID:          24578\nLatest checkpoint's NextMultiXactId:  1\nLatest checkpoint's NextMultiOffset:  0\nLatest checkpoint's oldestXID:        716\nLatest checkpoint's oldestXID's DB:   1\nLatest checkpoint's oldestActiveXID:  744\nLatest checkpoint's oldestMultiXid:   1\nLatest checkpoint's oldestMulti's DB: 1\nLatest checkpoint's oldestCommitTsXid:0\nLatest checkpoint's newestCommitTsXid:0\nTime of latest checkpoint:            Fri 24 Mar 2023 05:18:28 AM UTC\nFake LSN counter for unlogged rels:   0/3E8\nMinimum recovery ending location:     0/0\nMin recovery ending loc's timeline:   0\nBackup start location:                0/0\nBackup end location:                  0/0\nEnd-of-backup record required:        no\nwal_level setting:                    logical\nwal_log_hints setting:                on\nmax_connections setting:              100\nmax_worker_processes setting:         32\nmax_wal_senders setting:              10\nmax_prepared_xacts setting:           0\nmax_locks_per_xact setting:           64\ntrack_commit_timestamp setting:       off\nMaximum data alignment:               8\nDatabase block size:                  8192\nBlocks per segment of large relation: 131072\nWAL block size:                       8192\nBytes per WAL segment:                16777216\nMaximum length of identifiers:        64\nMaximum columns in an index:          32\nMaximum size of a TOAST chunk:        1996\nSize of a large-object chunk:         2048\nDate/time type storage:               64-bit integers\nFloat8 argument passing:              by value\nData page checksum version:           0\nMock authentication nonce:            b7f2f04197c763627732f064e0e1fca36c334973d9441ff8e49c207f6cd5a38f\n","pipe":"stdout","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"The PID file content is wrong, deleting it and assuming it's stale","file":"/var/lib/postgresql/data/pgdata/postmaster.pid","logging_pod":"cluster-example-3","err":"file does not exist","pidFileContents":""}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"2023-03-24 05:18:45.541 UTC [20] LOG:  redirecting log output to logging collector process","pipe":"stderr","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"2023-03-24 05:18:45.541 UTC [20] HINT:  Future log output will appear in directory \"/controller/log\".","pipe":"stderr","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"2023-03-24 05:18:45.541 UTC [20] LOG:  ending log output to stderr","source":"/controller/log/postgres","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"2023-03-24 05:18:45.541 UTC [20] HINT:  Future log output will go to log destination \"csvlog\".","source":"/controller/log/postgres","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:18:45.541 UTC","process_id":"20","session_id":"641d32b5.14","session_line_num":"1","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"ending log output to stderr","hint":"Future log output will go to log destination \"csvlog\".","backend_type":"postmaster","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:18:45.542 UTC","process_id":"20","session_id":"641d32b5.14","session_line_num":"2","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"starting PostgreSQL 15.2 (Debian 15.2-1.pgdg110+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 10.2.1-6) 10.2.1 20210110, 64-bit","backend_type":"postmaster","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:18:45.542 UTC","process_id":"20","session_id":"641d32b5.14","session_line_num":"3","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"listening on IPv4 address \"0.0.0.0\", port 5432","backend_type":"postmaster","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:18:45.542 UTC","process_id":"20","session_id":"641d32b5.14","session_line_num":"4","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"listening on IPv6 address \"::\", port 5432","backend_type":"postmaster","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:18:45Z","msg":"Instance is still down, will retry in 1 second","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"1c2d3ce1-9664-4ae9-be90-2ea8968f86ff","uuid":"598ce94b-ca03-11ed-9d47-ce5618e63535","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:18:45.558 UTC","process_id":"20","session_id":"641d32b5.14","session_line_num":"5","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"listening on Unix socket \"/controller/run/.s.PGSQL.5432\"","backend_type":"postmaster","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:18:45.564 UTC","process_id":"24","session_id":"641d32b5.18","session_line_num":"1","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"database system was interrupted; last known up at 2023-03-24 05:18:29 UTC","backend_type":"startup","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:18:45Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:18:45.707 UTC","process_id":"24","session_id":"641d32b5.18","session_line_num":"2","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"entering standby mode","backend_type":"startup","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:18:45Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:18:45Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:45Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:18:45.980 UTC","process_id":"24","session_id":"641d32b5.18","session_line_num":"3","session_start_time":"2023-03-24 05:18:45 UTC","virtual_transaction_id":"1/0","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"redo starts at 0/D000028","backend_type":"startup","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:46Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:46Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:18:46.115 UTC","process_id":"24","session_id":"641d32b5.18","session_line_num":"4","session_start_time":"2023-03-24 05:18:45 UTC","virtual_transaction_id":"1/0","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"consistent recovery state reached at 0/D000138","backend_type":"startup","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:18:46Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:18:46.115 UTC","process_id":"20","session_id":"641d32b5.14","session_line_num":"6","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"database system is ready to accept read-only connections","backend_type":"postmaster","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:46Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"b12a8d33-1041-458d-86ca-2d4ca8c8ab88","uuid":"5a0439d3-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"b12a8d33-1041-458d-86ca-2d4ca8c8ab88","uuid":"5a0439d3-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:18:46Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:18:46.278 UTC","process_id":"69","session_id":"641d32b6.45","session_line_num":"1","session_start_time":"2023-03-24 05:18:46 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"started streaming WAL from primary at 0/E000000 on timeline 4","backend_type":"walreceiver","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"46f9602c-68d7-4b26-b493-e2b5d7254936","uuid":"5a30466a-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"46f9602c-68d7-4b26-b493-e2b5d7254936","uuid":"5a30466a-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"5352e39f-b924-474d-8dea-ede1f66e82c0","uuid":"5a372931-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"5352e39f-b924-474d-8dea-ede1f66e82c0","uuid":"5a372931-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"1531d4e1-83a6-4b55-b032-f6d620d8850b","uuid":"5a3ecd80-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"1531d4e1-83a6-4b55-b032-f6d620d8850b","uuid":"5a3ecd80-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"c708e52e-a6e8-4289-9db8-5fb3444ad9ad","uuid":"5a4e167e-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"c708e52e-a6e8-4289-9db8-5fb3444ad9ad","uuid":"5a4e167e-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"137e9fba-b6d1-472c-96a2-7f9b3d3d62e1","uuid":"5a6256ea-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:18:46Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"137e9fba-b6d1-472c-96a2-7f9b3d3d62e1","uuid":"5a6256ea-ca03-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:23:45Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:23:45.656 UTC","process_id":"22","session_id":"641d32b5.16","session_line_num":"1","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"restartpoint starting: time","backend_type":"checkpointer","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:23:45Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:23:45.667 UTC","process_id":"22","session_id":"641d32b5.16","session_line_num":"2","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"restartpoint complete: wrote 1 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.002 s, sync=0.001 s, total=0.011 s; sync files=0, longest=0.000 s, average=0.000 s; distance=16384 kB, estimate=16384 kB","backend_type":"checkpointer","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:23:45Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:23:45.667 UTC","process_id":"22","session_id":"641d32b5.16","session_line_num":"3","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"recovery restart point at 0/E000060","backend_type":"checkpointer","query_id":"0"}}
Тут был убит мастер: {"level":"info","ts":"2023-03-24T05:27:56Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:27:56.975 UTC","process_id":"69","session_id":"641d32b6.45","session_line_num":"2","session_start_time":"2023-03-24 05:18:46 UTC","transaction_id":"0","error_severity":"FATAL","sql_state_code":"08P01","message":"could not receive data from WAL stream: FATAL:  terminating connection due to administrator command","backend_type":"walreceiver","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:27:57Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:27:57Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:27:57Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:27:57Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:27:57Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:27:57.236 UTC","process_id":"24","session_id":"641d32b5.18","session_line_num":"5","session_start_time":"2023-03-24 05:18:45 UTC","virtual_transaction_id":"1/0","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"invalid record length at 0/F000060: wanted 24, got 0","backend_type":"startup","query_id":"0"}}
Соединение закрыто: {"level":"info","ts":"2023-03-24T05:27:57Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:27:57.244 UTC","process_id":"282","session_id":"641d34dd.11a","session_line_num":"1","session_start_time":"2023-03-24 05:27:57 UTC","transaction_id":"0","error_severity":"FATAL","sql_state_code":"08006","message":"could not connect to the primary server: connection to server at \"cluster-example-rw\" (10.107.7.208), port 5432 failed: FATAL:  the database system is shutting down","backend_type":"walreceiver","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:27:57Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:27:57Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:27:57Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:27:57.375 UTC","process_id":"24","session_id":"641d32b5.18","session_line_num":"6","session_start_time":"2023-03-24 05:18:45 UTC","virtual_transaction_id":"1/0","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"waiting for WAL to become available at 0/F000078","backend_type":"startup","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:28:02Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:02Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:28:03Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"e36714ab-4aca-41a2-a09f-e730ced46175","uuid":"a60172c0-ca04-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:28:03Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"e36714ab-4aca-41a2-a09f-e730ced46175","uuid":"a60172c0-ca04-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:28:03Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"d595e805-e8c0-4f39-bd75-1afd98c17e7c","uuid":"a609651f-ca04-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:28:03Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"d595e805-e8c0-4f39-bd75-1afd98c17e7c","uuid":"a609651f-ca04-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:28:03Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"257d4523-c33b-4704-9364-646b18a7ca2f","uuid":"a610b339-ca04-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:28:03Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"257d4523-c33b-4704-9364-646b18a7ca2f","uuid":"a610b339-ca04-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:03Z","msg":"Setting myself as primary","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"257d4523-c33b-4704-9364-646b18a7ca2f","uuid":"a610b339-ca04-11ed-9d47-ce5618e63535","logging_pod":"cluster-example-3","phase":"Failing over","currentTimestamp":"2023-03-24T05:28:03.357392Z","targetPrimaryTimestamp":"2023-03-24T05:28:03.254770Z","currentPrimaryTimestamp":"2023-03-23T15:15:56.352347Z","msPassedSinceTargetPrimaryTimestamp":102,"msPassedSinceCurrentPrimaryTimestamp":51127005,"msDifferenceBetweenCurrentAndTargetPrimary":-51126902}
{"level":"info","ts":"2023-03-24T05:28:03Z","msg":"I'm the target primary, wait for the wal_receiver to be terminated","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"257d4523-c33b-4704-9364-646b18a7ca2f","uuid":"a610b339-ca04-11ed-9d47-ce5618e63535","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:03Z","msg":"I'm the target primary, applying WALs and promoting my instance","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"257d4523-c33b-4704-9364-646b18a7ca2f","uuid":"a610b339-ca04-11ed-9d47-ce5618e63535","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:03Z","msg":"Extracting pg_controldata information","logging_pod":"cluster-example-3","reason":"promote"}
{"level":"info","ts":"2023-03-24T05:28:03Z","logger":"pg_controldata","msg":"pg_control version number:            1300\nCatalog version number:               202209061\nDatabase system identifier:           7213723966086483989\nDatabase cluster state:               in archive recovery\npg_control last modified:             Fri 24 Mar 2023 05:23:45 AM UTC\nLatest checkpoint location:           0/E000098\nLatest checkpoint's REDO location:    0/E000060\nLatest checkpoint's REDO WAL file:    00000004000000000000000E\nLatest checkpoint's TimeLineID:       4\nLatest checkpoint's PrevTimeLineID:   4\nLatest checkpoint's full_page_writes: on\nLatest checkpoint's NextXID:          0:744\nLatest checkpoint's NextOID:          24578\nLatest checkpoint's NextMultiXactId:  1\nLatest checkpoint's NextMultiOffset:  0\nLatest checkpoint's oldestXID:        716\nLatest checkpoint's oldestXID's DB:   1\nLatest checkpoint's oldestActiveXID:  744\nLatest checkpoint's oldestMultiXid:   1\nLatest checkpoint's oldestMulti's DB: 1\nLatest checkpoint's oldestCommitTsXid:0\nLatest checkpoint's newestCommitTsXid:0\nTime of latest checkpoint:            Fri 24 Mar 2023 05:23:28 AM UTC\nFake LSN counter for unlogged rels:   0/3E8\nMinimum recovery ending location:     0/E000110\nMin recovery ending loc's timeline:   4\nBackup start location:                0/0\nBackup end location:                  0/0\nEnd-of-backup record required:        no\nwal_level setting:                    logical\nwal_log_hints setting:                on\nmax_connections setting:              100\nmax_worker_processes setting:         32\nmax_wal_senders setting:              10\nmax_prepared_xacts setting:           0\nmax_locks_per_xact setting:           64\ntrack_commit_timestamp setting:       off\nMaximum data alignment:               8\nDatabase block size:                  8192\nBlocks per segment of large relation: 131072\nWAL block size:                       8192\nBytes per WAL segment:                16777216\nMaximum length of identifiers:        64\nMaximum columns in an index:          32\nMaximum size of a TOAST chunk:        1996\nSize of a large-object chunk:         2048\nDate/time type storage:               64-bit integers\nFloat8 argument passing:              by value\nData page checksum version:           0\nMock authentication nonce:            b7f2f04197c763627732f064e0e1fca36c334973d9441ff8e49c207f6cd5a38f\n","pipe":"stdout","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:03Z","msg":"Promoting instance","logging_pod":"cluster-example-3","pgctl_options":["-D","/var/lib/postgresql/data/pgdata","-w","promote","-t 40000000"]}
{"level":"info","ts":"2023-03-24T05:28:03Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:28:03.362 UTC","process_id":"24","session_id":"641d32b5.18","session_line_num":"7","session_start_time":"2023-03-24 05:18:45 UTC","virtual_transaction_id":"1/0","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"received promote request","backend_type":"startup","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:28:12Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:28:12.257 UTC","process_id":"302","session_id":"641d34e2.12e","session_line_num":"1","session_start_time":"2023-03-24 05:28:02 UTC","transaction_id":"0","error_severity":"FATAL","sql_state_code":"08006","message":"could not connect to the primary server: could not translate host name \"cluster-example-rw\" to address: Name or service not known","backend_type":"walreceiver","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:28:12Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:12Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:28:12Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:12Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:12Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:28:12.518 UTC","process_id":"24","session_id":"641d32b5.18","session_line_num":"8","session_start_time":"2023-03-24 05:18:45 UTC","virtual_transaction_id":"1/0","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"redo done at 0/F000028 system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 566.54 s","backend_type":"startup","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:28:12Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:12Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:28:12Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:12Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:12Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:28:12.783 UTC","process_id":"24","session_id":"641d32b5.18","session_line_num":"9","session_start_time":"2023-03-24 05:18:45 UTC","virtual_transaction_id":"1/0","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"selected new timeline ID: 5","backend_type":"startup","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:28:13Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:13Z","logger":"wal-restore","msg":"tried restoring WALs, but no backup was configured","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:13Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:28:13.919 UTC","process_id":"24","session_id":"641d32b5.18","session_line_num":"10","session_start_time":"2023-03-24 05:18:45 UTC","virtual_transaction_id":"1/0","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"archive recovery complete","backend_type":"startup","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:28:13Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:28:13.927 UTC","process_id":"22","session_id":"641d32b5.16","session_line_num":"4","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"checkpoint starting: force","backend_type":"checkpointer","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:28:13Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:28:13.930 UTC","process_id":"20","session_id":"641d32b5.14","session_line_num":"7","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"database system is ready to accept connections","backend_type":"postmaster","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:28:13Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:28:13.951 UTC","process_id":"22","session_id":"641d32b5.16","session_line_num":"5","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"checkpoint complete: wrote 2 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.007 s, sync=0.006 s, total=0.025 s; sync files=2, longest=0.005 s, average=0.003 s; distance=16384 kB, estimate=16384 kB","backend_type":"checkpointer","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:28:13Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:13Z","logger":"wal-archive","msg":"Backup not configured, skip WAL archiving","logging_pod":"cluster-example-3","walName":"pg_wal/00000005.history","currentPrimary":"cluster-example-2","targetPrimary":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:13Z","logger":"pg_ctl","msg":"waiting for server to promote.............. done","pipe":"stdout","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:13Z","logger":"pg_ctl","msg":"server promoted","pipe":"stdout","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:13Z","msg":"Requesting a checkpoint","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:13Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:28:13.989 UTC","process_id":"22","session_id":"641d32b5.16","session_line_num":"6","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"checkpoint starting: immediate force wait","backend_type":"checkpointer","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:28:13Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:13Z","logger":"wal-archive","msg":"Backup not configured, skip WAL archiving","logging_pod":"cluster-example-3","walName":"pg_wal/00000004000000000000000F.partial","currentPrimary":"cluster-example-2","targetPrimary":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:28:14Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:28:14.009 UTC","process_id":"22","session_id":"641d32b5.16","session_line_num":"7","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"checkpoint complete: wrote 0 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.003 s, sync=0.001 s, total=0.020 s; sync files=0, longest=0.000 s, average=0.000 s; distance=0 kB, estimate=14745 kB","backend_type":"checkpointer","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:28:14Z","msg":"The PostgreSQL instance has been promoted successfully","logging_pod":"cluster-example-3"}
Теперь этот инстанс стал мастером: {"level":"info","ts":"2023-03-24T05:28:14Z","msg":"Finished setting myself as primary","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"257d4523-c33b-4704-9364-646b18a7ca2f","uuid":"a610b339-ca04-11ed-9d47-ce5618e63535","logging_pod":"cluster-example-3","phase":"Failing over","currentTimestamp":"2023-03-24T05:28:14.028906Z","targetPrimaryTimestamp":"2023-03-24T05:28:03.254770Z","currentPrimaryTimestamp":"2023-03-24T05:28:14.009399Z","msPassedSinceTargetPrimaryTimestamp":10774,"msPassedSinceCurrentPrimaryTimestamp":19,"msDifferenceBetweenCurrentAndTargetPrimary":10754}
{"level":"debug","ts":"2023-03-24T05:28:14Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"018e5a7e-bcba-47a1-a672-9c2b1aa38c31","uuid":"ac792409-ca04-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:28:14Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"018e5a7e-bcba-47a1-a672-9c2b1aa38c31","uuid":"ac792409-ca04-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:28:16Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"a2d3c4c3-02f1-4814-b025-62d2f1882f41","uuid":"adaeb353-ca04-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:28:16Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"a2d3c4c3-02f1-4814-b025-62d2f1882f41","uuid":"adaeb353-ca04-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:33:13Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:33:13.089 UTC","process_id":"22","session_id":"641d32b5.16","session_line_num":"8","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"checkpoint starting: time","backend_type":"checkpointer","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:33:14Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:33:14Z","logger":"wal-archive","msg":"Backup not configured, skip WAL archiving","logging_pod":"cluster-example-3","walName":"pg_wal/00000005000000000000000F","currentPrimary":"cluster-example-3","targetPrimary":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T05:33:15Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:33:15.213 UTC","process_id":"22","session_id":"641d32b5.16","session_line_num":"9","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"checkpoint complete: wrote 2 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=1.082 s, sync=0.002 s, total=2.125 s; sync files=2, longest=0.001 s, average=0.001 s; distance=6 kB, estimate=13271 kB","backend_type":"checkpointer","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T05:33:35Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"9c448642-f53b-4274-9a33-f8804b4f2566","uuid":"6c4cd833-ca05-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:33:35Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"9c448642-f53b-4274-9a33-f8804b4f2566","uuid":"6c4cd833-ca05-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:33:35Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"d6bb4d55-5442-4cf3-96c3-60c1203fff31","uuid":"6c57ac19-ca05-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:33:35Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"d6bb4d55-5442-4cf3-96c3-60c1203fff31","uuid":"6c57ac19-ca05-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:37:39Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"ae9a6745-d581-4168-8b88-4153e8527831","uuid":"fd426728-ca05-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:37:39Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"ae9a6745-d581-4168-8b88-4153e8527831","uuid":"fd426728-ca05-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:37:48Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"ac67de5f-1469-493a-a00f-aad9d6b0dae9","uuid":"0290cf22-ca06-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:37:48Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"ac67de5f-1469-493a-a00f-aad9d6b0dae9","uuid":"0290cf22-ca06-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:37:48Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"a8ec0abd-6205-4ee7-b418-60fa37e5cde9","uuid":"02a1c7b0-ca06-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:37:48Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"a8ec0abd-6205-4ee7-b418-60fa37e5cde9","uuid":"02a1c7b0-ca06-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:38:12Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"14f0dbfe-8330-416b-b625-64b89896b980","uuid":"1147fe32-ca06-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:38:12Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"14f0dbfe-8330-416b-b625-64b89896b980","uuid":"1147fe32-ca06-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:38:12Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"a8ecbe20-feed-4d4e-9f0e-92bd6f730284","uuid":"11515424-ca06-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T05:38:12Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"a8ecbe20-feed-4d4e-9f0e-92bd6f730284","uuid":"11515424-ca06-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"debug","ts":"2023-03-24T05:38:15Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
Тут реплика подключается: {"level":"info","ts":"2023-03-24T05:38:15Z","logger":"wal-archive","msg":"Backup not configured, skip WAL archiving","logging_pod":"cluster-example-3","walName":"pg_wal/000000050000000000000010","currentPrimary":"cluster-example-3","targetPrimary":"cluster-example-3"}
Здесь реплика отрубается от мастера: {"level":"info","ts":"2023-03-24T05:38:21Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:38:21.080 UTC","user_name":"streaming_replica","database_name":"postgres","process_id":"2826","connection_from":"10.40.1.239:35060","session_id":"641d3747.b0a","session_line_num":"1","command_tag":"SELECT","session_start_time":"2023-03-24 05:38:15 UTC","virtual_transaction_id":"3/4640","transaction_id":"0","error_severity":"LOG","sql_state_code":"08006","message":"could not send data to client: Connection reset by peer","query":"SELECT path, begin,\n  pg_read_binary_file(path, begin, len, true) AS chunk\nFROM unnest ($1::text[], $2::int8[], $3::int4[]) as x(path, begin, len)","application_name":"cluster-example-2","backend_type":"client backend","query_id":"0"}}
{"level":"info","ts":"2023-03-24T05:38:21Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 05:38:21.080 UTC","user_name":"streaming_replica","database_name":"postgres","process_id":"2826","connection_from":"10.40.1.239:35060","session_id":"641d3747.b0a","session_line_num":"2","command_tag":"SELECT","session_start_time":"2023-03-24 05:38:15 UTC","virtual_transaction_id":"3/4640","transaction_id":"0","error_severity":"FATAL","sql_state_code":"08006","message":"connection to client lost","query":"SELECT path, begin,\n  pg_read_binary_file(path, begin, len, true) AS chunk\nFROM unnest ($1::text[], $2::int8[], $3::int4[]) as x(path, begin, len)","application_name":"cluster-example-2","backend_type":"client backend","query_id":"0"}}
Реплика больше не пытается подключаться:
{"level":"debug","ts":"2023-03-24T06:00:33Z","msg":"Reconciling Cluster","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"5a89e498-c872-4738-a1d0-061741fa49b5","uuid":"30b10ed0-ca09-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:109","logging_pod":"cluster-example-3","cluster":{"apiVersion":"postgresql.cnpg.io/v1","kind":"Cluster","namespace":"default","name":"cluster-example"}}
{"level":"debug","ts":"2023-03-24T06:00:33Z","msg":"Reconciling custom monitoring queries","controller":"cluster","controllerGroup":"postgresql.cnpg.io","controllerKind":"Cluster","Cluster":{"name":"cluster-example","namespace":"default"},"namespace":"default","name":"cluster-example","reconcileID":"5a89e498-c872-4738-a1d0-061741fa49b5","uuid":"30b10ed0-ca09-11ed-9d47-ce5618e63535","caller":"internal/management/controller/instance_controller.go:727","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T06:13:13Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 06:13:13.910 UTC","process_id":"22","session_id":"641d32b5.16","session_line_num":"10","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"checkpoint starting: time","backend_type":"checkpointer","query_id":"0"}}
{"level":"info","ts":"2023-03-24T06:13:14Z","logger":"postgres","msg":"record","logging_pod":"cluster-example-3","record":{"log_time":"2023-03-24 06:13:14.025 UTC","process_id":"22","session_id":"641d32b5.16","session_line_num":"11","session_start_time":"2023-03-24 05:18:45 UTC","transaction_id":"0","error_severity":"LOG","sql_state_code":"00000","message":"checkpoint complete: wrote 1 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.101 s, sync=0.004 s, total=0.115 s; sync files=1, longest=0.004 s, average=0.004 s; distance=32767 kB, estimate=32767 kB","backend_type":"checkpointer","query_id":"0"}}
{"level":"debug","ts":"2023-03-24T06:13:16Z","msg":"Cached object request received","caller":"pkg/management/log/log.go:181","logging_pod":"cluster-example-3"}
{"level":"info","ts":"2023-03-24T06:13:16Z","logger":"wal-archive","msg":"Backup not configured, skip WAL archiving","logging_pod":"cluster-example-3","walName":"pg_wal/000000050000000000000011","currentPrimary":"cluster-example-3","targetPrimary":"cluster-example-3"}
